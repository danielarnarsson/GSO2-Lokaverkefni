CREATE DATABASE 1907002160_lokaverkefni;
USE 1907002160_lokaverkefni;

#1
CREATE TABLE MEMBERSHIP (
MEM_NUM INT PRIMARY KEY NOT NULL,
MEM_FNAME VARCHAR(32) NOT NULL,
MEM_LNAME VARCHAR(32) NOT NULL,
MEM_STREET VARCHAR(32) NOT NULL,
MEM_CITY VARCHAR(32) NOT NULL,
MEM_STATE CHAR(2) NOT NULL,
MEM_ZIP CHAR(5)NOT NULL,
MEM_BALANCE DECIMAL(6,2)
);

CREATE TABLE RENTAL (
RENT_NUM INT PRIMARY KEY NOT NULL,
RENT_DATE DATE,
MEM_NUM INT NOT NULL,
FOREIGN KEY (MEM_NUM) REFERENCES MEMBERSHIP(MEM_NUM)
);

CREATE TABLE PRICE (
PRICE_CODE VARCHAR(1) NOT NULL PRIMARY KEY,
PRICE_DESCRIPTION VARCHAR(100),
PRICE_RENTFEE INT NOT NULL,
PRICE_DAILYLATEFEE INT
);

CREATE TABLE MOVIE (
MOVIE_NUM INT NOT NULL PRIMARY KEY,
MOVIE_TITLE VARCHAR(255) NOT NULL,
MOVIE_YEAR YEAR,
MOVIE_COST DECIMAL(5,2) NOT NULL,
MOVIE_GENRE VARCHAR(100),
PRICE_CODE VARCHAR(1),
FOREIGN KEY (PRICE_CODE) REFERENCES PRICE(PRICE_CODE)
);

CREATE TABLE VIDEO (
VID_NUM INT NOT NULL PRIMARY KEY,
VID_INDATE DATE NOT NULL,
MOVIE_NUM INT NOT NULL,
FOREIGN KEY (MOVIE_NUM) REFERENCES MOVIE(MOVIE_NUM)
);

CREATE TABLE DETAILRENTAL (
RENT_NUM INT NOT NULL,
VID_NUM INT NOT NULL,
DETAIL_FEE DECIMAL(5,2),
DETAIL_DUEDATE DATE,
DETAIL_RETURNDATE DATE,
DETAIL_DAILYLATEFEE DECIMAL(5,2),
FOREIGN KEY (RENT_NUM) REFERENCES RENTAL(RENT_NUM),
FOREIGN KEY (VID_NUM) REFERENCES VIDEO(VID_NUM),
PRIMARY KEY (RENT_NUM, VID_NUM)
);



#2

INSERT INTO MEMBERSHIP (MEM_NUM,MEM_FNAME,MEM_LNAME,MEM_STREET, MEM_CITY,MEM_STATE,MEM_ZIP,MEM_BALANCE) VALUES
(102,'Tami', 'Dawson', '2632 Takli Circle', 'Norene', 'TN', '37136', 11),
(103, 'Curt', 'Knight', '4025 Cornell Court', 'Flatgap', 'KY', '41219', 6),
(104, 'Jamal', 'Melendez', '788 East 145th Avenue', 'Quebeck', 'TN', '38579', 0),
(105, 'Iva', 'Mcclain', '6045 Musket Ball Circle', 'Summit', 'KY', '42783', 15),
(106, 'Miranda', 'Parks', '4469 Maxwell Place', 'Germantown', 'TN', '38183', 0),
(107, 'Rosario', 'Elliott','7578 Danner Avenue', 'Columbia', 'TN', '38402', 5),
(108, 'Mattie', 'Guy', '40390 Evergreen Street', 'Lily', 'KY', '40740', 0),
(109, 'Clint', 'Ochoa', '1711 Elm Street', 'Greeneville', 'TN', '37745', 10),
(110, 'Lewis', 'Rosales', '4524 Southwind Circle', 'Counce', 'TN', '38326', 0),
(111, 'Stacy', 'Mann', '2789 East Cook Avenue', 'Murfreesboro', 'TN', '37132', 8),
(112, 'Luis', 'Trujillo', '7267 Melvin Avenue', 'Heiskell','TN', '37754', 3),
(113, 'Minnie','Gonzales', '6430 Vasili Drive', 'Williston', 'TN', '38076', 0);

INSERT INTO RENTAL (RENT_NUM, RENT_DATE, MEM_NUM) VALUES
(1001, '2009-03-01', 103),
(1002, '2009-03-01', 105),
(1003, '2009-03-02', 102),
(1004, '2009-03-02', 110),
(1005, '2009-03-02', 111),
(1006, '2009-03-02', 107),
(1007, '2009-03-02', 104),
(1008, '2009-03-03', 105),
(1009, '2009-03-03', 111);

INSERT INTO PRICE VALUES
('1', 'Standard', 2, 1),
('2', 'New Release', 3.5, 3),
('3', 'Discount', 1.5, 1),
('4', 'Weekly Special', 1, .5);

INSERT INTO MOVIE VALUES
(1234, "The Cesar Family Christmas", 2007, 39.95, 'FAMILY', 2),
(1235, "Smokey Mountain Wildlife", 2004, 59.95, 'ACTION', 1),
(1236, "Richard Goodhope", 2008, 59.95, 'DRAMA', 2),
(1237, "Beatnik Fever", 2007, 29.95, 'COMEDY', 2),
(1238, "Constant Companion", 2008, 89.95, 'DRAMA', null),
(1239, "Where Hope Dies", 1998, 25.49, 'DRAMA', 3),
(1245, "Time to Burn", 2005, 45.49, 'ACTION', 1),
(1246, "What He Doesn't Know", 2006, 58.29, 'COMEDY', 1);

INSERT INTO VIDEO VALUES
(34341, '2009-01-22', 1235),
(34342, '2009-01-22', 1235),
(34366, '2009-03-11', 1236),
(34367, '2009-03-11', 1236),
(34368, '2009-03-11', 1236),
(34369, '2009-03-11', 1236),
(44392, '2010-10-21', 1237),
(44397, '2010-10-21', 1237),
(54321, '2010-06-18', 1234),
(54324, '2010-06-18', 1234),
(54325, '2010-06-18', 1234),
(59237, '2011-02-14', 1237),
(61353, '2008-01-28', 1245),
(61354, '2008-01-28', 1245),
(61367, '2010-07-30', 1246),
(61369, '2010-07-30', 1246),
(61388, '2009-01-25', 1239);

INSERT INTO DETAILRENTAL VALUES
(1001, 34342, 2, '2009-03-04', '2009-03-02', 1),
(1001, 34366, 3.5, '2009-03-04', '2009-03-02', 3),
(1001, 61353, 2, '2009-03-04', '2009-03-03', 1),
(1002, 59237, 3.5, '2009-03-04', '2009-03-04', 3),
(1003, 54325, 3.5, '2009-03-04', '2009-03-09', 3),
(1003, 61369, 2, '2009-03-06', '2009-03-09', 1),
(1003, 61388, 0, '2009-03-06', '2009-03-09', 1),
(1004, 34341, 2, '2009-03-07', '2009-03-07', 1),
(1004, 34367, 3.5, '2009-03-05', '2009-03-07', 3),
(1004, 44392, 3.5, '2009-03-05', '2009-03-07', 3),
(1005, 34342, 2, '2009-03-07', '2009-03-05', 1),
(1005, 44397, 3.5, '2009-03-05', '2009-03-05', 3),
(1006, 34366, 3.5, '2009-03-05', '2009-03-04', 3),
(1006, 61367, 2, '2009-03-07', null, 1),
(1007, 34368, 3.5, '2009-03-05', null, 3),
(1008, 34369, 3.5, '2009-03-05', '2009-03-05', 3),
(1009, 54324, 3.5, '2009-03-05', null, 3);


#3
select MOVIE_TITLE, MOVIE_YEAR, MOVIE_COST FROM MOVIE WHERE MOVIE_TITLE LIKE '%hope%';


#4
select MOVIE_TITLE, MOVIE_YEAR, MOVIE_GENRE FROM MOVIE WHERE MOVIE_GENRE LIKE 'action';


#5
SELECT MOVIE_NUM, MOVIE_TITLE, MOVIE_COST FROM MOVIE WHERE MOVIE_COST > 40;


#6
SELECT MOVIE_NUM, MOVIE_TITLE, MOVIE_COST, MOVIE_GENRE FROM MOVIE WHERE MOVIE_GENRE LIKE 'ACTION' OR MOVIE_GENRE LIKE 'COMEDY' AND MOVIE_COST < 50;


#7
SELECT MOVIE_NUM, concat(MOVIE_TITLE, ' (',MOVIE_YEAR,') ',MOVIE_GENRE) AS 'Movie Description' FROM MOVIE;


#8
SELECT MOVIE_GENRE, COUNT(Movie_Num) AS 'Number of movies in genre' FROM MOVIE GROUP BY MOVIE_GENRE;


#9
SELECT ROUND(AVG(MOVIE_COST),4) as Average_Movie_Cost FROM MOVIE;


#10
SELECT MOVIE_GENRE, ROUND(avg(MOVIE_COST),2) as 'Average Movie Cost' FROM MOVIE GROUP BY MOVIE_GENRE;


#11
SELECT MOVIE_TITLE, MOVIE_GENRE, PRICE_DESCRIPTION, PRICE_RENTFEE FROM MOVIE, PRICE WHERE MOVIE.PRICE_CODE LIKE PRICE.PRICE_CODE;


#12
SELECT MOVIE_GENRE, ROUND(AVG(MOVIE_COST),2) AS 'Average Cost' FROM MOVIE, PRICE GROUP BY MOVIE_GENRE;


#13
SELECT MOVIE_TITLE, MOVIE_YEAR, ROUND(MOVIE_COST / PRICE_RENTFEE, 2) AS 'Breakeven Rentals' FROM MOVIE, PRICE WHERE PRICE.PRICE_CODE = MOVIE.PRICE_CODE;


#14
SELECT MOVIE_TITLE, MOVIE_YEAR FROM MOVIE  WHERE PRICE_CODE IS NOT NULL;


#15
SELECT MOVIE_TITLE, MOVIE_YEAR, MOVIE_COST FROM MOVIE WHERE MOVIE_COST > 44.99 AND MOVIE_COST < 49.99;


#16
SELECT MOVIE_TITLE, MOVIE_YEAR, PRICE_DESCRIPTION, PRICE_RENTFEE, MOVIE_GENRE FROM MOVIE, PRICE WHERE MOVIE_GENRE IN ('FAMILY', 'COMEDY', 'DRAMA') GROUP BY MOVIE_TITLE;


#17
SELECT MIN(MEM_BALANCE) AS 'Minimum Balance',
MAX(MEM_BALANCE) AS 'Maximum Balance',
ROUND(AVG(MEM_BALANCE), 2) AS 'Average Balance' 
	FROM MEMBERSHIP, RENTAL
		WHERE MEMBERSHIP.MEM_NUM = RENTAL.MEM_NUM;


#18
SELECT concat(MEM_FNAME, ' ', MEM_LNAME) AS 'Membership Name', CONCAT(MEM_STREET, ' ', MEM_CITY, ' ', MEM_ZIP) AS 'Membership Address' FROM MEMBERSHIP;


#19
SELECT DETAILRENTAL.RENT_NUM, RENT_DATE, DETAILRENTAL.VID_NUM, MOVIE_TITLE, DETAIL_DUEDATE, DETAIL_RETURNDATE 
FROM MOVIE, RENTAL, DETAILRENTAL, VIDEO
	WHERE DETAILRENTAL.RENT_NUM = RENTAL.RENT_NUM
		AND DETAIL_RETURNDATE > DETAIL_DUEDATE 
		AND	MOVIE.MOVIE_NUM = VIDEO.MOVIE_NUM 
		AND DETAILRENTAL.VID_NUM = VIDEO.VID_NUM 
	ORDER BY RENTAL.RENT_NUM, MOVIE_TITLE;

#21
#Finished in school but forgot to put it on github



#24
ALTER TABLE DETAILRENTAL
	ADD DETAIL_DAYSLATE NUMERIC(3,0);
    

DROP DATABASE 1907002160_lokaverkefni;